<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Ghi ch√∫ ki·ªÉm tra & x·ª≠ l√Ω s·ª± c·ªë server</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { color-scheme: dark; }
    body { background: #0f1420; }
    .card { background: #121a2a; border: 1px solid #1e2a44; border-radius: 14px; }
    .kbd{background:#0b1220;border:1px solid #1f2a44;border-bottom-width:2px;border-radius:8px;padding:.15rem .35rem}
    pre{white-space:pre-wrap}
    code{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
    a.anchor{color:#60a5fa;text-decoration:underline}
    .toc a{color:#94a3b8}
  </style>
</head>
<body class="text-slate-200">
  <div class="max-w-6xl mx-auto p-6">
    <header class="mb-6">
      <h1 class="text-3xl font-bold">üìì Ghi ch√∫ ki·ªÉm tra & x·ª≠ l√Ω s·ª± c·ªë server</h1>
      <p class="opacity-80">D√πng ƒë·ªÉ tra c·ª©u nhanh khi server lag / web ch·∫≠m / down. √Åp d·ª•ng cho VPS AZDIGI + ki·ªÉm tra qua SSH. (Web d√πng Caddy ‚Äì kh√¥ng nh·∫Øc Nginx)</p>
    </header>
<div class="mb-6">
  <a href="/solverviet_control_x2025" 
     class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-blue-500 to-indigo-500 
            hover:from-blue-600 hover:to-indigo-600 text-white font-medium shadow-lg transition-all duration-200">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
    </svg>
    Quay v·ªÅ ƒëi·ªÅu h∆∞·ªõng
  </a>
</div>

    <!-- TOC -->
<nav class="card p-4 mb-6 toc">
  <div class="font-semibold mb-2">M·ª•c l·ª•c</div>
  <ol class="list-decimal list-inside grid md:grid-cols-2 gap-y-1 text-sm">
    <li><a class="anchor" href="#azdigi">Xem bi·ªÉu ƒë·ªì tr√™n AZDIGI</a></li>
    <li><a class="anchor" href="#quick-check">Checklist nhanh khi web ch·∫≠m/ƒë∆°</a></li>
    <li><a class="anchor" href="#cpu-high">CPU cao: nguy√™n nh√¢n & kh·∫Øc ph·ª•c</a></li>
    <li><a class="anchor" href="#ram-high">RAM cao & OOM-killer</a></li>
    <li><a class="anchor" href="#disk-io">Disk full / I/O cao / inode full</a></li>
    <li><a class="anchor" href="#network">Network b·∫•t th∆∞·ªùng / nghi DDoS</a></li>
    <li><a class="anchor" href="#dns-namecheap">DNS & Domain (Namecheap): ‚ÄúAddress/A record b·ªã ƒë·ªïi‚Äù</a></li>
    <li><a class="anchor" href="#caddy">Caddy & ch·ª©ng ch·ªâ TLS</a></li>
    <li><a class="anchor" href="#db">Database (PostgreSQL) ‚Äì check nhanh</a></li>
    <li><a class="anchor" href="#hard-cases">C√°c t√¨nh hu·ªëng x·∫•u th∆∞·ªùng g·∫∑p</a></li>
    <li><a class="anchor" href="#ssl-time">SSL/TLS & ƒê·ªìng b·ªô th·ªùi gian</a></li>
    <li><a class="anchor" href="#firewall-port">Firewall & Port</a></li>
    <li><a class="anchor" href="#ulimit">Gi·ªõi h·∫°n t√†i nguy√™n (ulimit, file descriptor)</a></li>
    <li><a class="anchor" href="#service-reboot">Service ch·∫øt / reboot an to√†n</a></li>
    <li><a class="anchor" href="#postgres-advanced">PostgreSQL n√¢ng cao</a></li>
    <li><a class="anchor" href="#disk-health">·ªî ƒëƒ©a & s·ª©c kho·∫ª ph·∫ßn c·ª©ng</a></li>
    <li><a class="anchor" href="#security">B·∫£o m·∫≠t & s·ª± c·ªë b·ªã chi·∫øm quy·ªÅn</a></li>
    <li><a class="anchor" href="#queue-cache">H√†ng ƒë·ª£i & cache</a></li>
    <li><a class="anchor" href="#web-errors">App/Web: CORS, Mixed Content, 429</a></li>
    <li><a class="anchor" href="#email">Email deliverability</a></li>
    <li><a class="anchor" href="#runbook">Runbook kh·∫©n c·∫•p</a></li>
    <li><a class="anchor" href="#prevention">Ph√≤ng ng·ª´a (Best practices)</a></li>
    <li><a class="anchor" href="#check-ssl">Ki·ªÉm tra ng√†y h·∫øt h·∫°n SSL (Caddy + OpenSSL 3.x)</a></li>
  </ol>
</nav>
    <!-- 1. AZDIGI -->
    <section id="azdigi" class="card p-5 mb-6">
      <h2 class="text-xl font-semibold mb-2">1) Xem bi·ªÉu ƒë·ªì tr√™n AZDIGI</h2>
      <ol class="list-decimal list-inside space-y-2">
        <li>V√†o <a class="anchor" target="_blank" href="https://my.azdigi.com">my.azdigi.com</a> ‚Üí ƒêƒÉng nh·∫≠p.</li>
        <li><b>D·ªãch v·ª•</b> ‚Üí <b>Qu·∫£n l√Ω VPS</b> ‚Üí Ch·ªçn ƒë√∫ng VPS.</li>
        <li>Xem c√°c chart:
          <ul class="list-disc list-inside ml-5">
            <li><b>CPU Usage</b>: % CPU ƒëang s·ª≠ d·ª•ng (spike cao li√™n t·ª•c &gt;80% l√† b√°o ƒë·ªông).</li>
            <li><b>RAM</b>: % RAM; n·∫øu th∆∞·ªùng &gt; 90% + swap tƒÉng ‚Üí nguy c∆° OOM.</li>
            <li><b>Disk I/O</b>: ƒë·ªçc/ghi cao li√™n t·ª•c ‚Üí app ƒë·ªçc/ghi nhi·ªÅu ho·∫∑c swap.</li>
            <li><b>Network</b>: bƒÉng th√¥ng g·ª≠i/nh·∫≠n; ƒë·ªôt bi·∫øn ‚Üí t·∫£i l·ªõn ho·∫∑c DDoS.</li>
          </ul>
        </li>
        <li><b>Console</b> (trong AZDIGI) n·∫øu SSH kh√¥ng v√†o ƒë∆∞·ª£c.</li>
      </ol>
      <p class="text-sm text-amber-300 mt-2">M·∫πo: Ghi l·∫°i th·ªùi ƒëi·ªÉm spike ƒë·ªÉ so v·ªõi log ·ª©ng d·ª•ng.</p>
    </section>

    <!-- 2. Checklist nhanh -->
    <section id="quick-check" class="card p-5 mb-6">
      <h2 class="text-xl font-semibold mb-2">2) Checklist nhanh khi web ch·∫≠m/ƒë∆°</h2>
      <ul class="list-disc list-inside space-y-2">
        <li>Ping domain: <code>ping -c 3 yourdomain.com</code> (ch·ªâ ki·ªÉm tra reachability, kh√¥ng ƒëo web).</li>
        <li>HTTP alive: <code>curl -I https://yourdomain.com</code> (200/301/302 ok; 502/504 l·ªói upstream).</li>
        <li>Server alive qua IP: <code>curl -I --resolve yourdomain.com:443:YOUR_SERVER_IP https://yourdomain.com</code> (b·ªè qua DNS).</li>
        <li>CPU/RAM/Disk nhanh:
<pre><code>top -o %CPU
free -h
df -h    # dung l∆∞·ª£ng
df -i    # inode</code></pre>
        </li>
        <li>Log Caddy & h·ªá th·ªëng:
<pre><code>journalctl -u caddy --since "10 min ago"
journalctl -p err -xn
dmesg -T | tail -n 50   # t√¨m OOM/ l·ªói kernel</code></pre>
        </li>
      </ul>
    </section>

    <!-- 3. CPU cao -->
    <section id="cpu-high" class="card p-5 mb-6">
      <h2 class="text-xl font-semibold mb-2">3) CPU cao: nguy√™n nh√¢n & kh·∫Øc ph·ª•c</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <h3 class="font-medium mb-1">Nguy√™n nh√¢n th∆∞·ªùng g·∫∑p</h3>
          <ul class="list-disc list-inside space-y-1">
            <li>Traffic tƒÉng ƒë·ªôt bi·∫øn / DDoS layer 7.</li>
            <li>V√≤ng l·∫∑p v√¥ h·∫°n / task n·∫∑ng (AI, n√©n ·∫£nh, export, v.v.).</li>
            <li>GC/Interpreter (Python) t·ªën CPU do nhi·ªÅu request ƒë·ªìng th·ªùi.</li>
            <li>CPU <span class="kbd">steal</span> cao (VPS host b·∫≠n) ‚Äì m·∫•t t√†i nguy√™n.</li>
          </ul>
        </div>
        <div>
          <h3 class="font-medium mb-1">C√°ch ki·ªÉm tra</h3>
<pre><code>top -o %CPU
htop              # c·∫ßn: apt install htop
ps -eo pid,ppid,cmd,%cpu,%mem --sort=-%cpu | head -n 15
mpstat -P ALL 1 5 # sysstat
vmstat 1 5</code></pre>
        </div>
      </div>
      <h3 class="font-medium mt-3">Kh·∫Øc ph·ª•c nhanh</h3>
      <ul class="list-disc list-inside space-y-1">
        <li>X√°c ƒë·ªãnh PID ng·ªën CPU ‚Üí t·ªëi ∆∞u code / gi·ªõi h·∫°n concurrency.</li>
        <li>Th√™m cache (Redis), b·∫≠t CDN, rate limit.</li>
        <li>N·∫øu l√† VPS steal cao: m·ªü ticket AZDIGI nh·ªù ki·ªÉm tra node.</li>
      </ul>
    </section>

    <!-- 4. RAM cao & OOM -->
    <section id="ram-high" class="card p-5 mb-6">
      <h2 class="text-xl font-semibold mb-2">4) RAM cao & OOM-killer</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <h3 class="font-medium mb-1">D·∫•u hi·ªáu</h3>
          <ul class="list-disc list-inside space-y-1">
            <li>RAM g·∫ßn 100% + swap tƒÉng nhanh.</li>
            <li>·ª®ng d·ª•ng b·ªã kill ng·∫´u nhi√™n (OOM-killer).</li>
          </ul>
        </div>
        <div>
          <h3 class="font-medium mb-1">L·ªánh ki·ªÉm tra</h3>
<pre><code>free -h
dmesg -T | egrep -i "killed process|out of memory" | tail -n 20
ps -eo pid,cmd,%mem --sort=-%mem | head -n 15</code></pre>
        </div>
      </div>
      <h3 class="font-medium mt-3">Kh·∫Øc ph·ª•c nhanh</h3>
      <ul class="list-disc list-inside space-y-1">
        <li>T·∫°o swap (t·∫°m th·ªùi, n·∫øu ch∆∞a c√≥):
<pre><code>sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab</code></pre>
        </li>
        <li>T·ªëi ∆∞u app/DB, gi·ªõi h·∫°n worker/process, fix memory leak.</li>
        <li>N√¢ng RAM n·∫øu c·∫ßn.</li>
      </ul>
    </section>

    <!-- 5. Disk / I/O / inode -->
    <section id="disk-io" class="card p-5 mb-6">
      <h2 class="text-xl font-semibold mb-2">5) Disk full / I/O cao / inode full</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <h3 class="font-medium mb-1">Ki·ªÉm tra</h3>
<pre><code>df -h
df -i                  # inode
du -xh --max-depth=1 /var | sort -h
iostat -xz 1 3         # sysstat</code></pre>
        </div>
        <div>
          <h3 class="font-medium mb-1">X·ª≠ l√Ω nhanh</h3>
          <ul class="list-disc list-inside space-y-1">
            <li>D·ªçn log: <code>journalctl --vacuum-size=200M</code></li>
            <li>D·ªçn Docker: <code>docker system prune -af</code></li>
            <li>X√≥a file t·∫°m / build c≈©, xo√° core dump.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- 6. Network / DDoS -->
    <section id="network" class="card p-5 mb-6">
      <h2 class="text-xl font-semibold mb-2">6) Network b·∫•t th∆∞·ªùng / nghi DDoS</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <div>
          <h3 class="font-medium mb-1">Ki·ªÉm tra nhanh</h3>
<pre><code>ss -s                          # t·ªïng quan TCP
iftop -i eth0                  # c·∫ßn: apt install iftop
nload                          # xem t·ªïng in/out
tcpdump -n dst port 443 -c 200 # m·∫´u l∆∞u l∆∞·ª£ng ƒë·∫øn 443</code></pre>
        </div>
        <div>
          <h3 class="font-medium mb-1">D·∫•u hi·ªáu & x·ª≠ l√Ω</h3>
          <ul class="list-disc list-inside space-y-1">
            <li>ESTABLISHED tƒÉng nhanh b·∫•t th∆∞·ªùng ‚Üí c√≥ th·ªÉ DDoS L7 ‚Üí b·∫≠t CDN / WAF, rate limit.</li>
            <li>In/Out bƒÉng th√¥ng ƒë·ªôt bi·∫øn ‚Üí ki·ªÉm tra log truy c·∫≠p app / Caddy.</li>
            <li>T·∫°m th·ªùi ch·∫∑n IP x·∫•u (UFW/iptables) n·∫øu r√µ r√†ng.</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- 7. DNS / Namecheap -->
    <section id="dns-namecheap" class="card p-5 mb-6">
      <h2 class="text-xl font-semibold mb-2">7) DNS & Domain (Namecheap): ‚ÄúAddress/A record b·ªã ƒë·ªïi‚Äù</h2>

      <h3 class="font-medium mb-1">Tri·ªáu ch·ª©ng</h3>
      <ul class="list-disc list-inside">
        <li>Domain tr·ªè sang IP l·∫° (kh√¥ng ph·∫£i VPS c·ªßa b·∫°n).</li>
        <li>Web hi·ªÉn th·ªã trang l·∫° / parking / 404 c·ªßa b√™n th·ª© ba.</li>
      </ul>

      <h3 class="font-medium mt-3 mb-1">Nguy√™n nh√¢n ph·ªï bi·∫øn</h3>
      <ul class="list-disc list-inside space-y-1">
        <li><b>T√†i kho·∫£n Namecheap b·ªã l·ªô / API Token b·ªã l·∫°m d·ª•ng</b> ‚Üí A/AAAA record b·ªã s·ª≠a.</li>
        <li><b>B·∫≠t Dynamic DNS</b> tr√™n Namecheap ‚Üí m·ªôt client tr√™n PC/router ƒë√£ c·∫≠p nh·∫≠t IP m·ªõi.</li>
        <li><b>ƒê·ªïi Nameserver</b> sang nh√† kh√°c (Cloudflare, v.v.) ‚Üí ƒëang s·ª≠a DNS ·ªü n∆°i kh√°c, kh√¥ng ph·∫£i Namecheap.</li>
        <li><b>TTL/Propagation</b> ‚Üí m√°y b·∫°n/ISP c√≤n cache IP c≈©.</li>
        <li><b>Domain h·∫øt h·∫°n / grace</b> ‚Üí tr·ªè t·∫°m v·ªÅ parking IP.</li>
        <li><b>Nh·∫ßm b·∫£n ghi</b> (thay v√¨ A l·∫°i s·ª≠a CNAME/URL Redirect), ho·∫∑c s·ª≠a b·∫£n ghi ·ªü ‚ÄúEnvironment‚Äù sai (staging/prod).</li>
        <li><b>DNSSEC/Glue</b> c·∫•u h√¨nh sai ‚Üí ph√¢n gi·∫£i sai.</li>
        <li><b>Hosts file local</b> (Windows/macOS) b·ªã ch·ªânh ‚Üí tr·ªè domain sang IP l·∫°.</li>
      </ul>

      <h3 class="font-medium mt-3 mb-1">C√°ch ki·ªÉm tra ch√≠nh x√°c</h3>
<pre><code># 1) So DNS qua nhi·ªÅu resolver c√¥ng c·ªông
dig +short yourdomain.com A @8.8.8.8
dig +short yourdomain.com A @1.1.1.1

# 2) H·ªèi th·∫≥ng authority c·ªßa Namecheap (v√≠ d·ª• ns1/2.registrar-servers.com)
dig yourdomain.com A @ns1.registrar-servers.com +noall +answer

# 3) Xem nameserver hi·ªán t·∫°i
whois yourdomain.com | egrep -i "Name Server|Name Server:"

# 4) B·ªè qua DNS ƒë·ªÉ test ƒë√∫ng server c·ªßa b·∫°n
curl -I --resolve yourdomain.com:443:YOUR_SERVER_IP https://yourdomain.com

# 5) So file hosts (n·∫øu nghi ng·ªù)
# Windows: C:\Windows\System32\drivers\etc\hosts
# macOS/Linux: /etc/hosts</code></pre>

      <h3 class="font-medium mt-3 mb-1">C√°ch kh·∫Øc ph·ª•c</h3>
      <ol class="list-decimal list-inside space-y-1">
        <li><b>ƒê·ªïi m·∫≠t kh·∫©u Namecheap + b·∫≠t 2FA.</b></li>
        <li><b>Revoke API tokens</b> kh√¥ng d√πng; t·∫Øt <b>Dynamic DNS</b> n·∫øu kh√¥ng c·∫ßn.</li>
        <li>Ki·ªÉm tra & s·ª≠a l·∫°i b·∫£n ghi:  
          - <b>A</b> cho <code>@</code> ‚Üí IP VPS  
          - <b>A</b> cho <code>www</code> (ho·∫∑c CNAME <code>www ‚Üí @</code>)  
          - Ki·ªÉm tra <b>AAAA</b> (IPv6) n·∫øu c√≥ ‚Äì sai l√† tr·ªè sai web.  
          - TTL t·∫°m ƒë·ªÉ <b>5‚Äì10 ph√∫t</b> khi c·∫ßn test nhanh.
        </li>
        <li>N·∫øu d√πng Cloudflare: S·ª≠a DNS ·ªü Cloudflare (kh√¥ng ph·∫£i Namecheap), b·∫≠t ‚ÄúProxy‚Äù n·∫øu mu·ªën ·∫©n IP.</li>
        <li>X√≥a ch·ªânh s·ª≠a hosts local n·∫øu c√≥.</li>
        <li>ƒê·ª£i propagation (~5‚Äì30 ph√∫t th∆∞·ªùng ƒë·ªß). X√≥a cache DNS local:
<pre><code># Windows
ipconfig /flushdns
# macOS
sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder
# Linux (systemd-resolved)
sudo resolvectl flush-caches</code></pre>
        </li>
      </ol>

      <p class="text-sm text-amber-300 mt-2">Tip: L∆∞u l·∫°i ‚Äú·∫£nh ch·ª•p‚Äù c·∫•u h√¨nh DNS chu·∫©n (A, AAAA, CNAME) ƒë·ªÉ ƒë·ªëi chi·∫øu nhanh khi s·ª± c·ªë.</p>
    </section>

    <!-- 8. Caddy -->
    <section id="caddy" class="card p-5 mb-6">
      <h2 class="text-xl font-semibold mb-2">8) Caddy & TLS</h2>
      <ul class="list-disc list-inside">
        <li>Tr·∫°ng th√°i d·ªãch v·ª•:
<pre><code>systemctl status caddy
journalctl -u caddy --since "15 min ago"</code></pre>
        </li>
        <li>Test c·∫•u h√¨nh:
<pre><code>caddy validate --config /etc/caddy/Caddyfile</code></pre>
        </li>
        <li>Ch·ª©ng ch·ªâ/ACME fail th∆∞·ªùng do: DNS tr·ªè sai IP, port 80/443 b·ªã ch·∫∑n, ho·∫∑c app chi·∫øm port.</li>
        <li>Reload:
<pre><code>sudo systemctl reload caddy</code></pre>
        </li>
      </ul>
    </section>

    <!-- 9. DB -->
    <section id="db" class="card p-5 mb-6">
      <h2 class="text-xl font-semibold mb-2">9) PostgreSQL ‚Äì ki·ªÉm tra nhanh</h2>
      <ul class="list-disc list-inside">
        <li>Tr·∫°ng th√°i & log:
<pre><code>systemctl status postgresql
journalctl -u postgresql --since "15 min ago"</code></pre>
        </li>
        <li>K·∫øt n·ªëi & truy v·∫•n n·∫∑ng:
<pre><code>psql -U postgres -d slv_users -c "select pid,usename,query_start,wait_event_type,state,query from pg_stat_activity order by query_start asc limit 20;"</code></pre>
        </li>
        <li>Vacuum/Analyze ƒë·ªãnh k·ª≥; th√™m index cho truy v·∫•n ch·∫≠m.</li>
      </ul>
    </section>

    <!-- 10. Hard cases -->
    <section id="hard-cases" class="card p-5 mb-6">
      <h2 class="text-xl font-semibold mb-2">10) C√°c t√¨nh hu·ªëng x·∫•u & c√°ch x·ª≠ l√Ω</h2>
      <div class="space-y-2">
        <details class="bg-slate-800 rounded-md p-3">
          <summary class="cursor-pointer font-medium">CPU/RAM > 90% li√™n t·ª•c</summary>
          <ul class="list-disc list-inside mt-2">
            <li>X√°c ƒë·ªãnh PID n·∫∑ng (<code>top</code>, <code>ps ‚Ä¶ --sort=-%cpu</code> / <code>--sort=-%mem</code>).</li>
            <li>Gi·∫£m concurrency, th√™m queue/background job cho t√°c v·ª• n·∫∑ng.</li>
            <li>Th√™m cache/Redis; CDN cho static.</li>
            <li>Swap t·∫°m th·ªùi (n·∫øu thi·∫øu RAM) + t·ªëi ∆∞u app; c√¢n nh·∫Øc n√¢ng g√≥i.</li>
          </ul>
        </details>

        <details class="bg-slate-800 rounded-md p-3">
          <summary class="cursor-pointer font-medium">Disk 100% / inode full</summary>
          <ul class="list-disc list-inside mt-2">
            <li>D·ªçn log, build c≈©, cache; <code>journalctl --vacuum-size=200M</code>.</li>
            <li>Ki·ªÉm tra th∆∞ m·ª•c ph√¨nh to: <code>du -xh --max-depth=1 /var | sort -h</code>.</li>
            <li>N·∫øu inode full: x√≥a nhi·ªÅu file nh·ªè th·ª´a (cache/tmp).</li>
          </ul>
        </details>

        <details class="bg-slate-800 rounded-md p-3">
          <summary class="cursor-pointer font-medium">Network ƒë·ªôt bi·∫øn / nghi DDoS</summary>
          <ul class="list-disc list-inside mt-2">
            <li>Xem <code>ss -s</code>, <code>iftop</code>, <code>nload</code>.</li>
            <li>B·∫≠t CDN/WAF, rate limit; ch·∫∑n IP r√µ r√†ng.</li>
            <li>Log truy c·∫≠p ƒë·ªÉ truy v·∫øt ngu·ªìn.</li>
          </ul>
        </details>

        <details class="bg-slate-800 rounded-md p-3">
          <summary class="cursor-pointer font-medium">T√™n mi·ªÅn v·ªÅ trang l·∫° (A record b·ªã ƒë·ªïi)</summary>
          <ul class="list-disc list-inside mt-2">
            <li>Ki·ªÉm tra nameserver hi·ªán t·∫°i v√† A/AAAA record tr√™n Namecheap/Cloudflare.</li>
            <li>ƒê·ªïi pass, b·∫≠t 2FA Namecheap; t·∫Øt Dynamic DNS; revoke API tokens.</li>
            <li>S·ª≠a l·∫°i b·∫£n ghi ƒë√∫ng IP; TTL 5‚Äì10 ph√∫t; flush DNS client.</li>
          </ul>
        </details>

        <details class="bg-slate-800 rounded-md p-3">
          <summary class="cursor-pointer font-medium">Caddy kh√¥ng l√™n HTTPS</summary>
          <ul class="list-disc list-inside mt-2">
            <li>Ki·ªÉm tra DNS ƒë√∫ng IP; m·ªü port 80/443; <code>caddy validate</code>.</li>
            <li>Xem log ACME trong <code>journalctl -u caddy</code>.</li>
          </ul>
        </details>
      </div>
    </section>
    <!-- 11. SSL/TLS & ƒê·ªìng b·ªô th·ªùi gian -->
<section id="ssl-time" class="card p-5 mb-6">
  <h2 class="text-xl font-semibold mb-2">11) SSL/TLS & ƒê·ªìng b·ªô th·ªùi gian (HTTPS l·ªói b·∫•t ch·ª£t)</h2>
  <ul class="list-disc list-inside space-y-1">
    <li><b>Ch·ª©ng ch·ªâ h·∫øt h·∫°n</b> ho·∫∑c ACME gia h·∫°n l·ªói do DNS sai / port 80,443 b·ªã ch·∫∑n.</li>
    <li><b>Clock drift</b> (th·ªùi gian h·ªá th·ªëng l·ªách) ‚Üí TLS handshake fail.</li>
  </ul>
  <h3 class="font-medium mt-2">L·ªánh ki·ªÉm tra</h3>
  <pre><code>date                                  # gi·ªù h·ªá th·ªëng
timedatectl status                    # NTP/sync?
sudo timedatectl set-ntp true         # b·∫≠t NTP
journalctl -u caddy --since "30 min ago" | egrep -i "acme|cert|tls"</code></pre>
  <p class="text-sm opacity-80 mt-2">N·∫øu h·∫øt h·∫°n ‚Üí ki·ªÉm DNS/port v√† <code>systemctl reload caddy</code> ƒë·ªÉ re-issue.</p>
</section>

<!-- 12. Firewall & Port -->
<section id="firewall-port" class="card p-5 mb-6">
  <h2 class="text-xl font-semibold mb-2">12) Firewall & Port (m·ªü 80/443/DB)</h2>
  <pre><code>sudo ufw status
sudo ss -tulpn | egrep ":80|:443|:5432"
curl -I https://yourdomain.com
curl -I http://YOUR_SERVER_IP</code></pre>
  <p class="text-sm opacity-80">N·∫øu d√πng UFW: <code>sudo ufw allow 80,443/tcp</code>. ƒê·∫£m b·∫£o d·ªãch v·ª• th·∫≠t s·ª± l·∫Øng nghe ƒë√∫ng port.</p>
</section>

<!-- 13. Gi·ªõi h·∫°n t√†i nguy√™n (ulimit, file descriptor, process) -->
<section id="ulimit" class="card p-5 mb-6">
  <h2 class="text-xl font-semibold mb-2">13) Gi·ªõi h·∫°n t√†i nguy√™n: ‚ÄúToo many open files‚Äù / h·∫øt PID</h2>
  <ul class="list-disc list-inside">
    <li>Tri·ªáu ch·ª©ng: l·ªói <code>EMFILE</code>, kh√¥ng t·∫°o th√™m k·∫øt n·ªëi, service ch·∫øt ng·∫´u nhi√™n.</li>
  </ul>
  <pre><code>ulimit -n                         # s·ªë file descriptor
cat /proc/sys/fs/file-nr
cat /etc/systemd/system/&lt;service&gt;.service | egrep -i "LimitNOFILE|TasksMax"</code></pre>
  <p class="text-sm opacity-80">TƒÉng <code>LimitNOFILE</code> v√† kh·ªüi ƒë·ªông l·∫°i service b·∫±ng systemd n·∫øu c·∫ßn.</p>
</section>

<!-- 14. Kh·ªüi ƒë·ªông d·ªãch v·ª• & reboot an to√†n -->
<section id="service-reboot" class="card p-5 mb-6">
  <h2 class="text-xl font-semibold mb-2">14) Service ch·∫øt / pending reboot</h2>
  <pre><code>systemctl list-units --type=service --state=failed
needs-restarting -r   # (tr√™n CentOS/Alma) c√≥ c·∫ßn reboot?
last -x | head        # l·∫ßn reboot g·∫ßn nh·∫•t
systemctl restart caddy
systemctl restart postgresql</code></pre>
  <p class="text-sm opacity-80">Reboot an to√†n: th√¥ng b√°o b·∫£o tr√¨, stop job n·∫∑ng, <code>sync</code>, r·ªìi <code>reboot</code>.</p>
</section>

<!-- 15. PostgreSQL n√¢ng cao (kho√°, bloat, connection pool) -->
<section id="postgres-advanced" class="card p-5 mb-6">
  <h2 class="text-xl font-semibold mb-2">15) PostgreSQL n√¢ng cao: lock, bloat, connection pool</h2>
  <pre><code># K·∫øt n·ªëi ch·∫≠m / kho√°:
psql -U postgres -d slv_users -c "
SELECT pid,wait_event_type,wait_event,state,query
FROM pg_stat_activity
WHERE state &lt;&gt; 'idle'
ORDER BY query_start ASC LIMIT 20;"

# K·∫øt n·ªëi hi·ªán t·∫°i & gi·ªõi h·∫°n:
psql -U postgres -d slv_users -c "
SELECT count(*), max_conn FROM
 (SELECT 1 FROM pg_stat_activity WHERE datname=current_database()) t,
 (SELECT setting::int AS max_conn FROM pg_settings WHERE name='max_connections') s;"

# Bloat (c·∫ßn extension pgstattuple ho·∫∑c d√πng auto_explain/pg_stat_statements)</code></pre>
  <p class="text-sm opacity-80">N·∫øu ‚Äúqu√° nhi·ªÅu k·∫øt n·ªëi‚Äù: gi·∫£m pool size app, tƒÉng <code>max_connections</code> h·ª£p l√Ω, th√™m PG bouncer.</p>
</section>

<!-- 16. ·ªî ƒëƒ©a & s·ª©c kho·∫ª ph·∫ßn c·ª©ng -->
<section id="disk-health" class="card p-5 mb-6">
  <h2 class="text-xl font-semibold mb-2">16) ·ªî ƒëƒ©a & s·ª©c kho·∫ª (SMART, read-only b·∫•t ch·ª£t)</h2>
  <ul class="list-disc list-inside">
    <li>Tri·ªáu ch·ª©ng: h·ªá th·ªëng chuy·ªÉn read-only, I/O error.</li>
  </ul>
  <pre><code>sudo smartctl -a /dev/sda     # c·∫ßn smartmontools
dmesg -T | egrep -i "i/o error|read-only|ext4"
mount | column -t</code></pre>
  <p class="text-sm opacity-80">N·∫øu l·ªói ph·∫ßn c·ª©ng ‚Üí backup ngay, m·ªü ticket nh√† cung c·∫•p.</p>
</section>

<!-- 17. B·∫£o m·∫≠t & s·ª± c·ªë b·ªã chi·∫øm quy·ªÅn -->
<section id="security" class="card p-5 mb-6">
  <h2 class="text-xl font-semibold mb-2">17) B·∫£o m·∫≠t: t√†i kho·∫£n/SSH/DNS b·ªã can thi·ªáp</h2>
  <ul class="list-disc list-inside space-y-1">
    <li>SSH: ki·ªÉm tra login l·∫°</li>
  </ul>
  <pre><code>last -a | head -n 20
journalctl -u ssh --since "1 day ago" | egrep -i "Failed|Accepted"</code></pre>
  <ul class="list-disc list-inside space-y-1 mt-2">
    <li>Ki·ªÉm tra crontab l·∫° / script kh·ªüi ƒë·ªông:</li>
  </ul>
  <pre><code>crontab -l
ls -la /etc/cron.* /var/spool/cron
systemctl list-unit-files | egrep -i "enabled"
sudo find /etc/systemd -type f -maxdepth 3 | xargs grep -iE "curl|wget|bash -c" -n</code></pre>
  <p class="text-sm opacity-80">ƒê·ªïi m·∫≠t kh·∫©u, t·∫Øt root SSH, b·∫≠t 2FA c√°c t√†i kho·∫£n (Namecheap, VPS panel), rotate API tokens.</p>
</section>

<!-- 18. H√†ng ƒë·ª£i & cache (Redis, Celery, RabbitMQ) -->
<section id="queue-cache" class="card p-5 mb-6">
  <h2 class="text-xl font-semibold mb-2">18) Queue/Cache: backlog, OOM, key bloat</h2>
  <pre><code>redis-cli info memory
redis-cli info stats | egrep -i "keyspace|rejected|evicted"

# N·∫øu d√πng Celery:
journalctl -u celery --since "30 min ago"
# RabbitMQ:
sudo rabbitmqctl list_queues name messages_ready messages_unacknowledged</code></pre>
  <p class="text-sm opacity-80">Backlog tƒÉng ‚Üí scale worker, h·∫πn gi·ªù job, ƒë·∫∑t timeout v√† retry c√≥ backoff.</p>
</section>

<!-- 19. ·ª®ng d·ª•ng & c·∫•u h√¨nh Web (CORS, mixed content, 429) -->
<section id="web-errors" class="card p-5 mb-6"> 
  <h2 class="text-xl font-semibold mb-2">19) App/Web: CORS, Mixed Content, Rate limit</h2>
  <ul class="list-disc list-inside">
    <li>CORS sai ‚Üí request b·ªã block (ki·ªÉm tra header <code>Access-Control-Allow-*</code>).</li>
    <li>Mixed content HTTPS/HTTP ‚Üí tr√¨nh duy·ªát ch·∫∑n.</li>
    <li>429/Rate limit ‚Üí ph√≠a app/CDN ch·∫∑n do qu√° nhi·ªÅu request.</li>
  </ul>
  <pre><code>curl -I https://yourdomain.com/path
# xem header tr·∫£ v·ªÅ & m√£ l·ªói (200/301/302 t·ªët, 4xx/5xx c·∫ßn soi log)</code></pre>
</section>

<!-- 20. Email (n·∫øu c√≥) -->
<section id="email" class="card p-5 mb-6">
  <h2 class="text-xl font-semibold mb-2">20) Email deliverability (n·∫øu h·ªá th·ªëng g·ª≠i mail)</h2>
  <ul class="list-disc list-inside">
    <li>SPF/DKIM/DMARC ch∆∞a c·∫•u h√¨nh ‚Üí mail v√†o spam.</li>
    <li>SMTP b·ªã ch·∫∑n b·ªüi nh√† m·∫°ng/VPS.</li>
  </ul>
  <pre><code>dig txt yourdomain.com
dig txt default._domainkey.yourdomain.com
dig txt _dmarc.yourdomain.com</code></pre>
</section>

<!-- 21. Quy tr√¨nh kh·∫©n c·∫•p (Runbook ng·∫Øn) -->
<section id="runbook" class="card p-5 mb-6">
  <h2 class="text-xl font-semibold mb-2">21) Runbook kh·∫©n c·∫•p</h2>
  <ol class="list-decimal list-inside space-y-1">
    <li>G·∫Øn banner ‚ÄúB·∫£o tr√¨‚Äù (HTTP 503) n·∫øu c·∫ßn gi·∫£m t·∫£i.</li>
    <li>Ki·ªÉm tra nhanh: CPU/RAM/Disk/Network + log Caddy + log app.</li>
    <li>X√°c ƒë·ªãnh service/PID g√¢y t·∫£i ‚Üí t·∫°m gi·∫£m concurrency ho·∫∑c restart c√≥ ki·ªÉm so√°t.</li>
    <li>ƒê·∫£m b·∫£o DB ·ªïn: k·∫øt n·ªëi, lock, long query.</li>
    <li>N·∫øu nghi ph·∫ßn c·ª©ng/VPS host: m·ªü ticket AZDIGI (k√®m th·ªùi ƒëi·ªÉm & log).</li>
  </ol>
</section>

<!-- 22. Ph√≤ng ng·ª´a -->
<section id="prevention" class="card p-5 mb-6">
  <h2 class="text-xl font-semibold mb-2">22) Ph√≤ng ng·ª´a (Best practices)</h2>
  <ul class="list-disc list-inside space-y-1">
    <li>Backup ƒë·ªãnh k·ª≥ + test kh√¥i ph·ª•c (DB & file).</li>
    <li>Log rotate, d·ªçn r√°c (journal, docker, build c≈©).</li>
    <li>Gi·ªõi h·∫°n t√†i nguy√™n m·ªói service (systemd, ulimit), ƒë·∫∑t healthcheck.</li>
    <li>CDN + cache + rate limit; theo d√µi alert CPU/RAM/HTTP 5xx.</li>
    <li>Ch·ª•p ·∫£nh c·∫•u h√¨nh DNS chu·∫©n (Namecheap/Cloudflare) ƒë·ªÉ ƒë·ªëi chi·∫øu nhanh.</li>
  </ul>
</section>
<!-- 23. Ki·ªÉm tra ng√†y h·∫øt h·∫°n SSL (Caddy + OpenSSL 3.x) -->
<section id="check-ssl" class="card p-5 mb-6">
  <h2 class="text-xl font-semibold mb-2">23) Ki·ªÉm tra ng√†y h·∫øt h·∫°n SSL (Caddy + OpenSSL 3.x)</h2>
  <p class="mb-2">D√πng l·ªánh n√†y ƒë·ªÉ ki·ªÉm tra ch·ª©ng ch·ªâ HTTPS c·ªßa domain, √°p d·ª•ng khi server d√πng OpenSSL 3.x (m·∫∑c ƒë·ªãnh tr√™n Ubuntu 22.04+). L·ªánh n√†y l·∫•y th√¥ng tin tr·ª±c ti·∫øp t·ª´ ch·ª©ng ch·ªâ ƒëang ho·∫°t ƒë·ªông tr√™n c·ªïng 443.</p>
  <pre><code>echo | openssl s_client -servername yourdomain.com -connect yourdomain.com:443 2>/dev/null \
| sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' \
| openssl x509 -noout -dates</code></pre>
  <p class="mt-2 text-sm opacity-80">Thay <code>yourdomain.com</code> b·∫±ng domain th·∫≠t. K·∫øt qu·∫£ hi·ªÉn th·ªã:</p>
  <ul class="list-disc list-inside text-sm opacity-80 mb-2">
    <li><b>notBefore</b> ‚Äì ng√†y ch·ª©ng ch·ªâ b·∫Øt ƒë·∫ßu c√≥ hi·ªáu l·ª±c.</li>
    <li><b>notAfter</b> ‚Äì ng√†y ch·ª©ng ch·ªâ h·∫øt h·∫°n.</li>
  </ul>
  <p class="text-sm opacity-80">Caddy s·∫Ω t·ª± ƒë·ªông gia h·∫°n khi c√≤n &lt;30 ng√†y tr∆∞·ªõc h·∫°n. N·∫øu mu·ªën gia h·∫°n th·ªß c√¥ng, d√πng <code>sudo systemctl reload caddy</code> v√† ki·ªÉm tra l·∫°i log v·ªõi <code>journalctl -u caddy | grep -i renew</code>.</p>
</section>


    <footer class="text-xs opacity-70 mt-6">
      Tip: L∆∞u checklist n√†y trong admin ƒë·ªÉ ai tr·ª±c c≈©ng x·ª≠ l√Ω theo t·ª´ng b∆∞·ªõc gi·ªëng nhau.
    </footer>
  </div>
</body>
</html>
