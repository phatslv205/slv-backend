<script src="https://unpkg.com/lucide@latest"></script>
<style>.user-avatar{width:100px;height:100px;object-fit:cover;border-radius:50%;transition:0.3s;}.special-frame{border:3px solid #4a7576;box-shadow:0 0 15px #ffff85;animation:glow-special 2s infinite;}.uncommon-frame{border:2px solid #ffaa00;box-shadow:0 0 8px #ffaa00;}@keyframes glow-special{0%{box-shadow:0 0 10px #00ffff;}50%{box-shadow:0 0 20px #00ffff;}100%{box-shadow:0 0 10px #00ffff;}}</style>
  <form method="POST" action="/user-info" enctype="multipart/form-data">
<div style="text-align: center; margin-bottom: 20px;">
  <label for="avatarInput" style="cursor: pointer; display: inline-block; position: relative;">
    <img id="previewAvatar"
     src="{{ user.avatar_url if user.avatar_url else '/static/logos/logo.png' }}"
      alt=""
      class="user-avatar
      {% if user.ai_personality in ['SLV', 'Tinh tế'] %} special-frame
      {% elif user.ai_personality in ['Ngầu lòi', 'Yandere', 'Già đời', 'Cute lạc', 'Bad girl', 'Bad boy', 'Logic cao', 'Tấu hài', 'Lạnh lùng'] %} uncommon-frame
      {% endif %}">

    <div style="position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%); background: #00ffff; color: #000; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px;">+</div>
  </label>
  <input id="avatarInput" type="file" name="avatar" accept="image/*" onchange="previewAvt(this)" style="display: none;">
</div>
      <label>Tên để AI chat với bạn:</label>
      <input type="text" name="fullname" value="{{ user.fullname }}">
      <label>Tên đăng nhập:</label>
      <input type="text" value="{{ username }}" disabled>
       <label>ID:</label>
      <input type="text" value="{{ user.user_id }}" disabled>

<label>Mật khẩu:</label>
<div class="input-group" style="display: flex; align-items: center;">
  <input type="password" value="{{ user.password }}" id="maskedPassword" disabled style="flex: 1;">
  <button type="button" id="togglePassBtn" onclick="toggleMaskedPassword()"
    style="margin-left: 8px; padding: 4px 8px; font-size: 13px; background: #00e5ff; color: black; border: none; border-radius: 4px;">
    Hiện
  </button>
</div>

{% if user.is_verified %}
  <div style="font-size: 13px; margin-top: 4px;">
    <a href="/change-password" style="color: #00e5ff; text-decoration: underline;">Đổi mật khẩu</a>
  </div>
{% else %}
  <div style="font-size: 13px; color: #ff5252; margin-top: 4px;">
    Cần xác thực email để đổi mật khẩu
  </div>
{% endif %}


<label>Email:</label>
<div class="input-group">
  <input type="email" name="email" value="{{ user.email }}" readonly>

  {% if not user.is_verified %}
    <div class="email-warning">
      Chưa xác thực ✖ 
      <a href="/verify-otp" class="verify-link">Xác thực ngay</a>
    </div>
    <div style="font-size: 13px; margin-top: 4px;">
      <a href="#" class="verify-link" onclick="handleBlockedChangeEmail(event)">Đổi email</a>
    </div>
  {% else %}
    <div style="font-size: 13px; margin-top: 4px;">
      <a href="#" class="verify-link" onclick="handleVerifiedEmail(event)">Email đã xác thực</a>
    </div>
  {% endif %}
</div>
  <label>Gói AI hiện tại:</label>
    <div class="input-group">
      <input type="text" readonly value="
        {% if user.vip_gpt_ai and user.vip_until_gpt %}
          SLV  - {{ (user.vip_until_gpt - now).days + 1 }} ngày
        {% elif user.vip_ai_lite and user.vip_until_lite %}
          Lite - {{ (user.vip_until_lite - now).days + 1 }} ngày
        {% else %}
          Chưa đăng ký gói
        {% endif %}
      ">
    </div>
    <label>Hết hạn lúc:</label>
    <div class="input-group">
      <input type="text" readonly value="
        {% if user.vip_gpt_ai and user.vip_until_gpt %}
          {{ user.vip_until_gpt.strftime('%H:%M:%S • %d/%m/%Y') }}
        {% elif user.vip_ai_lite and user.vip_until_lite %}
          {{ user.vip_until_lite.strftime('%H:%M:%S • %d/%m/%Y') }}
        {% else %}
          Không có
        {% endif %}
      ">
    </div>
<label>Tính cách AI của bạn:</label>
<div class="input-group">
  <input type="text" readonly value="{{ user.ai_personality or 'Chưa có' }}" style="width: 100%; padding: 10px; border-radius: 8px; background: #1f2a33; color: white;">
<button id="random-ai-btn" type="button" style="margin-top: 10px;">Reroll AI</button>
<label>Referral code</label>
<input type="text" readonly value="{{ user.referral_code }}" style="background: #1a1a1a; color: #00ffcc; font-weight: bold; border-radius: 6px;">
<button type="button" onclick="openRewardPopup()">Thông tin nhận thưởng</button>
<button type="submit">Lưu thay đổi</button>  
    </form>
     <form method="POST" action="/user-info/delete-avatar" style="margin-top: 10px;">
  <button type="submit" style="background: #ff4d4f; padding: 6px 12px; border-radius: 6px; border: none; color: white; font-weight: 600; cursor: pointer;">
     Xoá ảnh đại diện
  </button>
<style>.terms-link{color:#1e90ff;text-decoration:none;}.terms-link:hover{text-decoration:underline;}@media(prefers-color-scheme:dark){.terms-link{color:#4ea6ff;}}@media(prefers-color-scheme:light){.terms-link{color:#1e90ff;}}</style>
<a href="#" onclick="openTermsModal()" class="terms-link">Điều khoản sử dụng</a>
<script>
  function toggleMaskedPassword() {
    const input = document.getElementById("maskedPassword");
    const btn = document.getElementById("togglePassBtn");

    if (input.type === "password") {
      input.type = "text";
      btn.textContent = "Ẩn";
    } else {
      input.type = "password";
      btn.textContent = "Hiện";
    }
  }
</script>

</form>
