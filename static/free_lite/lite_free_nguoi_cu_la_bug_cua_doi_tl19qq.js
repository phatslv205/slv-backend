function startNewChat(){const oldWarn=document.getElementById("chat-warning");if(oldWarn)oldWarn.remove();fetch("/new_chat",{method:"POST"}).then(res=>res.json()).then(data=>{if(data.success){chat_history=[];const container=document.getElementById("chat-container");container.innerHTML="";const imgPreview=document.getElementById("image-preview");const filePreview=document.getElementById("file-preview");const fileInput=document.getElementById("file-input");const uploadInput=document.getElementById("upload-input");if(imgPreview)imgPreview.innerHTML="";if(filePreview)filePreview.innerHTML="";if(fileInput)fileInput.value="";if(uploadInput)uploadInput.value="";container.scrollTop=0;location.reload()}else{console.error("❌ Lỗi khi tạo đoạn chat mới:",data.error||"Không rõ nguyên nhân");alert("⚠️ Không thể tạo đoạn chat mới. Vui lòng thử lại.")}}).catch(err=>{console.error("❌ Lỗi kết nối khi tạo đoạn chat mới:",err);alert("⚠️ Không thể kết nối với máy chủ. Vui lòng thử lại.")});}